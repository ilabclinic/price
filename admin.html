<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>iLab لوحة الإدارة</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root{--bg:#f7fbff;--card:#fff;--accent:#0f6fa6;--accent2:#0fa37a;--muted:#6b7280;}
body{font-family:'Cairo',sans-serif;background:linear-gradient(180deg,var(--bg),#eef6f8);margin:0;padding:22px;direction:rtl;color:#043047;}
.wrap{max-width:980px;margin:0 auto;}
.card{background:var(--card);padding:18px;border-radius:14px;box-shadow:0 6px 30px rgba(2,6,23,0.06);margin-bottom:18px;}
.title{font-weight:700;color:#08304a;margin-bottom:10px}
input,select{width:100%;padding:10px;border-radius:10px;border:1px solid #e8f1f7;margin-bottom:8px}
.btn{background:var(--accent);color:#fff;padding:12px;border-radius:10px;border:0;cursor:pointer;font-weight:700}
.small{font-size:13px;color:var(--muted);}
.table{width:100%;border-collapse:collapse;margin-top:10px}
.table th,.table td{border:1px solid #e8f1f7;padding:8px;text-align:right;font-size:14px}
.table th{background:#f0f7fb}
</style>
</head>
<body>
<div class="wrap">
  <!-- إضافة فحص -->
  <div class="card">
    <div class="title">إضافة فحص جديد</div>
    <input id="testName" placeholder="اسم الفحص">
    <input id="testPrice" placeholder="السعر بالدينار">
    <button class="btn" onclick="addTest()">أضف الفحص</button>
    <div id="testResult" class="small"></div>
  </div>

  <!-- إضافة كوبون -->
  <div class="card">
    <div class="title">إضافة كوبون خصم</div>
    <input id="couponCode" placeholder="كود الكوبون">
    <select id="couponType">
      <option value="percent">نسبة %</option>
      <option value="fixed">قيمة ثابتة</option>
    </select>
    <input id="couponValue" placeholder="قيمة الخصم">
    <button class="btn" onclick="addCoupon()">أضف الكوبون</button>
    <div id="couponResult" class="small"></div>
  </div>

  <!-- عرض الحجوزات -->
  <div class="card">
    <div class="title">الحجوزات المسجلة</div>
    <table class="table">
      <thead>
        <tr>
          <th>تاريخ ووقت الحجز</th>
          <th>الاسم</th>
          <th>رقم الهاتف</th>
          <th>الفحوصات</th>
          <th>السعر الإجمالي</th>
        </tr>
      </thead>
      <tbody id="appointmentsBody">
        <tr><td colspan="5" class="small">تحميل…</td></tr>
      </tbody>
    </table>
  </div>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbw-LYZhxTiVzFU9F_OWZgWZGXvmFsfmp5UbcFP0x27OYHis6EYSWBgdse34i4Wkj9Wm/exec"; // ضع رابط Web App هنا

// إضافة فحص
async function addTest(){
  const name=document.getElementById('testName').value.trim();
  const price=document.getElementById('testPrice').value.trim();
  if(!name||!price){ alert('الرجاء إدخال الاسم والسعر'); return; }
  try{
    const resp=await fetch(`${API}?action=addTest&name=${encodeURIComponent(name)}&price=${encodeURIComponent(price)}`);
    const data=await resp.json();
    document.getElementById('testResult').innerText=data.status;
    document.getElementById('testName').value=''; document.getElementById('testPrice').value='';
  }catch(e){ console.error(e); alert('تعذر إضافة الفحص'); }
}

// إضافة كوبون
async function addCoupon(){
  const code=document.getElementById('couponCode').value.trim();
  const type=document.getElementById('couponType').value;
  const value=document.getElementById('couponValue').value.trim();
  if(!code||!value){ alert('الرجاء إدخال الكود والقيمة'); return; }
  try{
    const resp=await fetch(`${API}?action=addCoupon&code=${encodeURIComponent(code)}&type=${type}&value=${encodeURIComponent(value)}`);
    const data=await resp.json();
    document.getElementById('couponResult').innerText=data.status;
    document.getElementById('couponCode').value=''; document.getElementById('couponValue').value='';
  }catch(e){ console.error(e); alert('تعذر إضافة الكوبون'); }
}

// جلب الحجوزات
async function loadAppointments(){
  try{
    const resp=await fetch(`${API}?action=getAppointments`);
    const data=await resp.json();
    const tbody=document.getElementById('appointmentsBody');
    tbody.innerHTML='';
    if(!data.length){ tbody.innerHTML='<tr><td colspan="5" class="small">لا توجد حجوزات حتى الآن</td></tr>'; return; }
    data.forEach(row=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${row[0]}</td><td>${row[1]}</td><td>${row[2]}</td><td>${row[3]}</td><td>${row[4]}</td>`;
      tbody.appendChild(tr);
    });
  }catch(e){ console.error(e); document.getElementById('appointmentsBody').innerHTML='<tr><td colspan="5">تعذر تحميل الحجوزات</td></tr>'; }
}

// init
loadAppointments();
</script>
</body>
</html>
