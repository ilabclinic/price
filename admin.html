<!-- admin.html -->
<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ± - iLab</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#f4f7fb; --card:#ffffff; --accent:#0f6fa6; --muted:#6b7280; --success:#16a34a;
    --glass: rgba(255,255,255,0.7);
  }
  *{box-sizing:border-box}
  body{font-family:'Cairo',sans-serif;background:linear-gradient(180deg,#eef6fb 0%,var(--bg) 100%);margin:0;padding:28px;color:#0b2540;direction:rtl}
  .wrap{max-width:980px;margin:0 auto}
  header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
  h1{margin:0;font-size:20px;color:var(--accent)}
  .sub{color:var(--muted);font-size:13px}
  .grid{display:grid;grid-template-columns:1fr 360px;gap:18px;align-items:start}
  .card{background:var(--card);border-radius:14px;padding:18px;box-shadow:0 6px 20px rgba(16,24,40,0.06)}
  label{display:block;font-weight:600;margin-top:10px;font-size:14px}
  input[type="text"], input[type="number"], select{width:100%;padding:10px;border-radius:8px;border:1px solid #e6edf3;margin-top:6px;font-size:14px}
  button{background:var(--accent);color:#fff;padding:10px 14px;border-radius:10px;border:0;cursor:pointer;margin-top:12px;font-weight:600}
  button.ghost{background:transparent;color:var(--accent);border:1px solid #d3e8f5}
  .list{max-height:420px;overflow:auto;margin-top:10px}
  .row{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:8px;border:1px solid #f0f6fb;margin-bottom:8px}
  .name{font-weight:600}
  .price{color:var(--muted)}
  .small{font-size:13px;color:var(--muted)}
  .message{margin-top:8px;padding:10px;background:#f0fdf4;color:var(--success);border-radius:8px;display:none}
  footer{margin-top:18px;color:var(--muted);font-size:13px;text-align:center}
  @media (max-width:880px){.grid{grid-template-columns:1fr;}.card{padding:14px}}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ± â€” iLab</h1>
        <div class="sub">Ø£Ø¶Ù/Ø¹Ø¯Ù„ Ø§Ù„ÙØ­ÙˆØµØ§Øª ÙˆØ§Ù„ÙƒÙˆØ¨ÙˆÙ†Ø§Øª Ø¨Ø³Ø±Ø¹Ø© ÙˆØ£Ù…Ø§Ù†</div>
      </div>
      <div class="small">Ù…Ø±Ø¨ÙˆØ· Ø¨Ù€ WebApp API</div>
    </header>

    <div class="grid">
      <!-- ÙŠØ³Ø§Ø±: Ø§Ù„ØªØ­ÙƒÙ… -->
      <div class="card">
        <h3>â• Ø¥Ø¶Ø§ÙØ© ÙØ­Øµ Ø¬Ø¯ÙŠØ¯</h3>
        <label>Ø§Ø³Ù… Ø§Ù„ÙØ­Øµ</label>
        <input id="testName" type="text" placeholder="Ù…Ø«Ø§Ù„: ÙØ­Øµ CRP">
        <label>Ø§Ù„Ø³Ø¹Ø± (Ø¯ÙŠÙ†Ø§Ø±)</label>
        <input id="testPrice" type="number" placeholder="Ù…Ø«Ø§Ù„: 20">

        <button onclick="onAddTest()">Ø£Ø¶Ù Ø§Ù„ÙØ­Øµ</button>

        <hr style="margin:18px 0;border:none;border-top:1px solid #f0f6fb">

        <h3>ğŸŸï¸ Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ¨ÙˆÙ†</h3>
        <label>ÙƒÙˆØ¯ Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†</label>
        <input id="couponCode" type="text" placeholder="Ù…Ø«Ø§Ù„: ILAB10">
        <label>Ù†ÙˆØ¹ Ø§Ù„Ø®ØµÙ…</label>
        <select id="couponType">
          <option value="percent">Ù†Ø³Ø¨Ø© Ù…Ø¦ÙˆÙŠØ© %</option>
          <option value="fixed">Ù…Ø¨Ù„Øº Ø«Ø§Ø¨Øª</option>
        </select>
        <label>Ø§Ù„Ù‚ÙŠÙ…Ø© (Ù…Ø«Ù„Ø§Ù‹: 10 Ø£Ùˆ 5)</label>
        <input id="couponValue" type="number" placeholder="Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ…">

        <button onclick="onAddCoupon()">Ø£Ø¶Ù Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†</button>

        <div id="msg" class="message"></div>
      </div>

      <!-- ÙŠÙ…ÙŠÙ†: Ø¹Ø±Ø¶ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… -->
      <div>
        <div class="card" style="margin-bottom:12px">
          <h3>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ­ÙˆØµØ§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h3>
          <div id="testsList" class="list">
            Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...
          </div>
        </div>

        <div class="card">
          <h3>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h3>
          <div id="couponsList" class="list">
            Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...
          </div>
        </div>
      </div>
    </div>

    <footer>ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© Ù†Ø´Ø± Ø§Ù„ÙˆÙŠØ¨ Ø¢Ø¨ Ø¨Ø¹Ø¯ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³ÙƒØ±Ø¨Øª. ØªÙ… ØªØµÙ…ÙŠÙ… Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ù„ØªÙƒÙˆÙ† Ø¨Ø³ÙŠØ·Ø© ÙˆØ³Ø±ÙŠØ¹Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù….</footer>
  </div>

<script>
  const API = "https://script.google.com/macros/s/AKfycbw-LYZhxTiVzFU9F_OWZgWZGXvmFsfmp5UbcFP0x27OYHis6EYSWBgdse34i4Wkj9Wm/exec";

  function showMsg(text, ok=true) {
    const el = document.getElementById('msg');
    el.style.display = 'block';
    el.style.background = ok ? '#f0fdf4' : '#fff4f4';
    el.style.color = ok ? '#166534' : '#b91c1c';
    el.innerText = text;
    setTimeout(()=> el.style.display='none', 4000);
  }

  async function fetchLists(){
    try{
      const t = await fetch(API + '?action=getTests').then(r=>r.json());
      const c = await fetch(API + '?action=getCoupons').then(r=>r.json());
      renderTests(t || []);
      renderCoupons(c || []);
    }catch(err){
      document.getElementById('testsList').innerText='ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª';
      document.getElementById('couponsList').innerText='ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª';
      console.error(err);
    }
  }

  function renderTests(data){
    const out = document.getElementById('testsList');
    out.innerHTML = '';
    if(!data.length){ out.innerHTML = '<div class="small">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ­ÙˆØµØ§Øª Ù…Ø³Ø¬Ù„Ø©</div>'; return; }
    data.forEach(row=>{
      const name = row[0] || 'â€”';
      const price = row[1] || 'â€”';
      const div = document.createElement('div');
      div.className='row';
      div.innerHTML = `<div><div class="name">${escapeHtml(name)}</div><div class="small">ÙˆØµÙ Ø§Ø®ØªÙŠØ§Ø±ÙŠ</div></div><div class="price">${escapeHtml(price)} Ø¯.Ø§</div>`;
      out.appendChild(div);
    });
  }

  function renderCoupons(data){
    const out = document.getElementById('couponsList');
    out.innerHTML = '';
    if(!data.length){ out.innerHTML = '<div class="small">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙˆØ¨ÙˆÙ†Ø§Øª</div>'; return; }
    data.forEach(row=>{
      const code = row[0]||'â€”';
      const type = row[1]||'â€”';
      const val = row[2]||'â€”';
      const div = document.createElement('div');
      div.className='row';
      div.innerHTML = `<div><div class="name">${escapeHtml(code)}</div><div class="small">${escapeHtml(type)} â€¢ Ø§Ù„Ù‚ÙŠÙ…Ø©: ${escapeHtml(val)}</div></div><div class="price">${type==='percent'?val+'%':val+' Ø¯.Ø§'}</div>`;
      out.appendChild(div);
    });
  }

  function escapeHtml(s){ return (s+'').replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m])); }

  async function onAddTest(){
    const name = document.getElementById('testName').value.trim();
    const price = document.getElementById('testPrice').value.trim();
    if(!name || !price){ showMsg('Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø³Ø¹Ø±', false); return; }
    try{
      const res = await fetch(API + `?action=addTest&test=${encodeURIComponent(name)}&price=${encodeURIComponent(price)}`);
      const j = await res.json();
      if(j.error) showMsg(j.error, false); else { showMsg(j.result || 'ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©'); fetchLists(); document.getElementById('testName').value=''; document.getElementById('testPrice').value=''; }
    }catch(e){ showMsg('ÙØ´Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙØ©', false); console.error(e); }
  }

  async function onAddCoupon(){
    const code = document.getElementById('couponCode').value.trim();
    const type = document.getElementById('couponType').value;
    const value = document.getElementById('couponValue').value.trim();
    if(!code || !type || !value){ showMsg('Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ¹Ø¨Ø¦Ø© Ø­Ù‚ÙˆÙ„ Ø§Ù„ÙƒÙˆØ¨ÙˆÙ† ÙƒÙ„Ù‡Ø§', false); return; }
    try{
      const res = await fetch(API + `?action=addCoupon&code=${encodeURIComponent(code)}&type=${encodeURIComponent(type)}&value=${encodeURIComponent(value)}`);
      const j = await res.json();
      if(j.error) showMsg(j.error, false); else { showMsg(j.result || 'ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†'); fetchLists(); document.getElementById('couponCode').value=''; document.getElementById('couponValue').value=''; }
    }catch(e){ showMsg('ÙØ´Ù„ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†', false); console.error(e); }
  }

  // init
  fetchLists();
</script>
</body>
</html>
