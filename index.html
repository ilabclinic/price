<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>إدارة iLab</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#f7fbff; --card:#ffffff; --accent:#0f6fa6; --accent-2:#0fa37a; --muted:#6b7280; --shadow:0 6px 30px rgba(2,6,23,0.08);
}
*{box-sizing:border-box}
body{font-family:'Cairo',sans-serif;background:linear-gradient(180deg,var(--bg),#eef6f8);margin:0;padding:22px;direction:rtl;color:#043047}
.wrap{max-width:980px;margin:0 auto}
header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;gap:12px}
h1{margin:0;font-size:22px;color:var(--accent)}
.sub{color:var(--muted);font-size:13px}
.layout{display:grid;grid-template-columns:1fr 1fr;gap:18px;align-items:start}
.card{background:var(--card);padding:20px;border-radius:18px;box-shadow:var(--shadow);transition:0.3s}
.card:hover{box-shadow:0 12px 40px rgba(2,6,23,0.15);transform:translateY(-2px)}
.title{font-weight:700;color:#08304a;margin-bottom:10px}
input[type="text"], input[type="number"], select{width:100%;padding:10px;border-radius:12px;border:1px solid #e8f1f7;margin-bottom:12px;outline:none;transition:0.3s}
input:focus, select:focus{border-color:var(--accent-2);box-shadow:0 0 10px rgba(15,111,166,0.2)}
.btn{background: linear-gradient(135deg,#0f6fa6,#0fa37a);color:#fff;padding:12px;border-radius:12px;border:0;cursor:pointer;font-weight:700;transition:0.3s;letter-spacing:1px}
.btn:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(15,111,166,0.3)}
.result{margin-top:15px;padding:12px;border-radius:12px;background:#f0f9ff;color:#043047;box-shadow:0 4px 20px rgba(0,0,0,0.05)}
#appointmentsList div{margin-bottom:8px;padding-bottom:6px;border-bottom:1px solid #e6f0f7}
@media(max-width:880px){.layout{grid-template-columns:1fr}.card{padding:16px}}
</style>
</head>
<body>
<div class="wrap">
<header>
  <div>
    <h1>إدارة فحوصات وكوبونات iLab</h1>
    <div class="sub">أضف فحوصات وكوبونات واطلع على الحجوزات</div>
  </div>
</header>

<div class="layout">
  <!-- إضافة فحص -->
  <div class="card">
    <div class="title">➕ إضافة فحص جديد</div>
    <input type="text" id="testName" placeholder="اسم الفحص">
    <input type="number" id="testPrice" placeholder="السعر بالدينار">
    <button class="btn" onclick="addTest()">إضافة الفحص</button>
    <div id="testResult" class="result"></div>
  </div>

  <!-- إضافة كوبون -->
  <div class="card">
    <div class="title">🎟️ إضافة كوبون خصم</div>
    <input type="text" id="couponCode" placeholder="كود الكوبون">
    <select id="couponType">
      <option value="percent">نسبة مئوية (%)</option>
      <option value="fixed">قيمة ثابتة</option>
    </select>
    <input type="number" id="couponValue" placeholder="قيمة الخصم">
    <button class="btn" onclick="addCoupon()">إضافة الكوبون</button>
    <div id="couponResult" class="result"></div>
  </div>

  <!-- الحجوزات -->
  <div class="card" style="grid-column:1/3">
    <div class="title">📋 الحجوزات</div>
    <div id="appointmentsList" style="max-height:300px;overflow:auto;"></div>
    <button class="btn" onclick="loadAppointments()">تحديث الحجوزات</button>
  </div>
</div>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbw-LYZhxTiVzFU9F_OWZgWZGXvmFsfmp5UbcFP0x27OYHis6EYSWBgdse34i4Wkj9Wm/exec";

async function addTest(){
  const name = document.getElementById('testName').value.trim();
  const price = parseFloat(document.getElementById('testPrice').value);
  if(!name || isNaN(price)){ alert('الرجاء إدخال اسم الفحص والسعر'); return; }
  const resp = await fetch(`${API}?action=addTest&name=${encodeURIComponent(name)}&price=${price}`);
  const data = await resp.json();
  document.getElementById('testResult').innerText=data.status||'تم الإضافة';
  document.getElementById('testName').value=''; document.getElementById('testPrice').value='';
}

async function addCoupon(){
  const code = document.getElementById('couponCode').value.trim();
  const type = document.getElementById('couponType').value;
  const value = parseFloat(document.getElementById('couponValue').value);
  if(!code || isNaN(value)){ alert('الرجاء إدخال الكوبون والقيمة'); return; }
  const resp = await fetch(`${API}?action=addCoupon&code=${encodeURIComponent(code)}&type=${type}&value=${value}`);
  const data = await resp.json();
  document.getElementById('couponResult').innerText=data.status||'تم الإضافة';
  document.getElementById('couponCode').value=''; document.getElementById('couponValue').value='';
}

async function loadAppointments(){
  try{
    const resp = await fetch(`${API}?action=getAppointments`);
    const data = await resp.json();
    const container = document.getElementById('appointmentsList');
    container.innerHTML='';
    if(!data.length){ container.innerHTML='<div class="small">لا توجد حجوزات حتى الآن</div>'; return; }
    data.forEach(row=>{
      const div = document.createElement('div');
      div.innerHTML=`<strong>${row[1]}</strong> | ${row[2]}<br>فحوصات: ${row[3]}<br>السعر: ${row[4]} د.ا<br><small>${new Date(row[0]).toLocaleString()}</small>`;
      container.appendChild(div);
    });
  }catch(e){ console.error(e); alert('تعذر تحميل الحجوزات'); }
}
</script>
</body>
</html>
